<!DOCTYPE html>
<html lang="en">
<head>
  <title>Milky Way Mania</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="style.css" type="text/css">
  <script type="text/javascript" src="./js/third-party/gl-matrix-master/dist/gl-matrix.js"></script>
  <script type="text/javascript" src="./js/third-party/three.js-master/build/three.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script src="./js/TrackballControls.js"></script>
  <script src="./js/third-party/three.js-master/examples/js/controls/OrbitControls.js"></script>
  <script src="./js/functions.js"></script>
  <!-- <script type="text/javascript" src="./planetRendering.js"></script> -->
</head>

<body>
  <div id="container" onmouseout="enableTrackball()">
    <!-- The canvas where the rendering takes place -->
    <div class="GUI">
      <p>Mountains</p>
      <input type="range" id="amp-slider" min="0" max="50" step="0.1" value="1" onmouseover="disableTrackball()" >
      <p>Valleys</p>
      <input type="range" id="valley-slider" min="0" max="50" step="0.1" value="0" onmouseover="disableTrackball()" >
      <p>Amplitude small</p>
      <input type="range" id="amp-small-slider" min="0" max="1" step="0.15" value="1" onmouseover="disableTrackball()" >
      <p>Radius</p>
      <input type="range" id="radius-slider" min="1" max="10" step="0.1" value="1" onmouseover="disableTrackball()" >
      <p>Water level</p>
      <input type="range" id="water-slider" min="-50" max="100" step="0.05" value="-10" onmouseover="disableTrackball()" >
      <p>Snow level</p>
      <input type="range" id="snow-slider" min="-50" max="100" step="0.05" value="5" onmouseover="disableTrackball()" >

    </div>
  </div>
</body>

<script type="x-shader/x-vertex" id="watervertexshader">

// switch on high precision floats
#ifdef GL_ES
precision highp float;
#endif

varying vec3 vPos;
varying vec3 vNormal;
varying vec3 vLightPosition;

uniform float waterLevel;
uniform float planetRadiusWater;
uniform vec3 lightPosition;

void main(){

  vLightPosition = vec3( vec4( lightPosition, 1.0) * modelViewMatrix);

  vNormal = normalMatrix * normal;
  vPos = (modelMatrix * vec4(position, 1.0 )).xyz;
  vec3 newPosition = position + normal * vec3(waterLevel, waterLevel, waterLevel) * vec3 (planetRadiusWater, planetRadiusWater, planetRadiusWater);

  gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
}

</script>
<script type="x-shader/x-fragment" id="waterfragmentshader">

#ifdef GL_ES
precision highp float;
#endif

varying vec3 vPos;
varying vec3 vNormal;
varying vec3 vLightPosition;

void main(){

  float Ka = 0.8;   // Ambient reflection coefficient
  float Kd = 0.6;   // Diffuse reflection coefficient
  float Ks = 0.6;   // Specular reflection coefficient
  float shininessVal = 2.0; // Shininess

  //From vshader
  vec3 lightPos = vLightPosition;

  vec3 N = normalize(vNormal);
  vec3 L = normalize(lightPos - vPos);

  float lambertian = max(dot(N, L), 0.0);

  float specular = 0.0;

  if(lambertian > 0.0) {
    vec3 R = reflect(-L, N);      // Reflected light vector
    vec3 V = normalize(-vPos); // Vector to viewer

    // Compute the specular term
    float specAngle = max(dot(R, V), 0.0);
    specular = pow(specAngle, shininessVal);
  }

   vec4 waterColor = vec4(0.2, 0.2, 0.8, 1.0);
  vec4 ambientColor = waterColor*0.2;
  vec4 diffuseColor = waterColor;
  vec4  specularColor = vec4(1.0, 1.0, 1.0, 1.0);

  vec3 first = vec3(Ka * ambientColor);
  vec3 second = vec3(Kd * lambertian * diffuseColor);
  vec3 third = vec3(Ks * specular * specularColor);

   gl_FragColor = vec4(first + second , 1.0);
  // gl_FragColor 	= waterColor;
}
</script>
<!-- End Shaders -->

<!-- Load shaders -->
<script src="./js/shaderLoader.js"></script>

<!-- Launch the loop -->
<script type="text/javascript" src="./main.js"></script>

</html>
